SlardarLite.plugin.sample=function(){"use strict";function f(r,n){var t="function"==typeof Symbol&&r[Symbol.iterator];if(!t)return r;var e,u,i=t.call(r),f=[];try{for(;(void 0===n||0<n--)&&!(e=i.next()).done;)f.push(e.value)}catch(r){u={error:r}}finally{try{e&&!e.done&&(t=i.return)&&t.call(i)}finally{if(u)throw u.error}}return f}function l(r){return r}var e=Object.prototype;function v(r,n){if("[object Array]"!==e.toString.call(r))return!1;if(0===r.length)return!1;for(var t=0;t<r.length;){if(r[t]===n)return!0;t++}return!1}function o(r){return Math.random()<Number(r)}function a(r,n){return r<Number(n)}function t(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var t=function(r){if(r)return r.l||(r.l={Slardar:{plugins:[],errors:[],subject:{}}}),r.l.Slardar}(function(){if("object"==typeof window&&("object"==typeof(r=window)&&null!==r))return window;var r}());t&&(t.errors||(t.errors=[]),t.errors.push(r))}function u(r,n,t,e){var u;return void 0!==(n=function(r,n,t){for(var e,n=f(n.split(".")),u=n[0],i=n.slice(1);r&&0<i.length;)r=r[u],u=(e=f(i))[0],i=e.slice(1);if(r)return t(r,u)}(r,n,function(r,n){return r[n]}))&&function(r,n,t){switch(t){case"eq":return v(n,r);case"neq":return!v(n,r);case"gt":return r>n[0];case"gte":return r>=n[0];case"lt":return r<n[0];case"lte":return r<=n[0];case"regex":return Boolean(r.match(new RegExp(n.join("|"))));case"not_regex":return!r.match(new RegExp(n.join("|")));default:return!1}}(n,(u="boolean"==typeof n?"bool":"number"==typeof n?"number":"string",e.map(function(r){switch(u){case"number":return Number(r);case"boolean":return"1"===r;default:return String(r)}})),t)}var s=function(r,n){var t=r.common||{};return t.sample_rate=n,r.common=t,r},b=function(r,n,t,e,u){return r?(i=u(e,n),function(){return i}):function(){return t(n)};var i},m=function(n,r){try{return"rule"===r.type?u(n,r.field,r.op,r.values):"and"===r.type?r.children.every(function(r){return m(n,r)}):r.children.some(function(r){return m(n,r)})}catch(r){return t(r),!1}},p=function(u,i,f,o,a,c){var l={};return Object.keys(u).forEach(function(r){var n=u[r],t=n.enable,e=n.sample_rate,n=n.conditional_sample_rules;t?(l[r]={enable:t,sample_rate:e,effectiveSampleRate:e*f,hit:b(i,e,o,a,c)},n&&(l[r].conditional_hit_rules=n.map(function(r){var n=r.sample_rate,r=r.filter;return{sample_rate:n,hit:b(i,n,o,a,c),effectiveSampleRate:n*f,filter:r}}))):l[r]={enable:t,hit:function(){return!1},sample_rate:0,effectiveSampleRate:0}}),l};return function(i,r){return r&&i.s(function(e){var u;r.u(function(r){var n=i.config,t=n.userId,n=n.sample;n!==u&&(u=n,i.sampler=function(r,n,t,e){if(!n)return l;var u=n.sample_rate,i=n.include_users,f=n.sample_granularity,o=n.rules,n=n.r,n=void 0===n?Math.random():n;if(v(i,r))return function(r){return s(r,1)};var f="session"===f,a=b(f,u,t,n,e),c=p(o,f,u,t,n,e);return function(r){if(!a())return!1;if(!(r.ev_type in c))return s(r,u);if(!c[r.ev_type].enable)return!1;if(null!==(n=r.common)&&void 0!==n&&n.sample_rate)return r;var n=c[r.ev_type],t=n.conditional_hit_rules;if(t)for(var e=0;e<t.length;e++)if(m(r,t[e].filter))return!!t[e].hit()&&s(r,t[e].effectiveSampleRate);return!!n.hit()&&s(r,n.effectiveSampleRate)}}(t,n,o,a));r=i.sampler(r);r&&e(r)})})}}();
