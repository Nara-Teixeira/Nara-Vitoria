"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[7494],{83509:(e,t,r)=>{function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(){i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,o){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype),u=new L(o||[]);return n(a,"_invoke",{value:k(e,r,u)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var f={};function h(){}function v(){}function p(){}var g={};c(g,a,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(E([])));y&&y!==t&&r.call(y,a)&&(g=y);var b=p.prototype=h.prototype=Object.create(g);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function o(n,i,a,u){var s=d(e[n],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){o("next",e,a,u)}),(function(e){o("throw",e,a,u)})):t.resolve(l).then((function(e){c.value=e,a(c)}),(function(e){return o("throw",e,a,u)}))}u(s.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function k(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=_(a,r);if(u){if(u===f)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=d(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return v.prototype=p,n(b,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:v,configurable:!0}),v.displayName=c(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},x(w.prototype),c(w.prototype,u,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=E,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function a(e,t,r,n,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function u(e){a(i,n,o,u,s,"next",e)}function s(e){a(i,n,o,u,s,"throw",e)}u(void 0)}))}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}function g(e,t){if(e){if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{b:()=>T}),r(49979),r(3495),r(17021);var y=r(27160),b=r(54880),x=r(54139),w=r(47793),k=r(46976),_=l((function e(t,r){s(this,e),this.type="file",this.message=t,this.data=r})),S=function(){function e(){s(this,e),d(this,"_data",Object.create(null))}return l(e,[{key:"set",value:function(e,t){this._data[e]=t}},{key:"get",value:function(e){return this._data[e]}},{key:"clear",value:function(){this._data=Object.create(null)}}]),e}();function O(e,t){var r=e.trak;if(r&&r.length){var n=r.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),o=r.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(n||o){var i,a=[],u=[];if(n){var s,c,l,d=null===(s=n.mdia)||void 0===s||null===(c=s.minf)||void 0===c?void 0:c.stbl;if(!d)return;var f=null===(l=n.mdia.mdhd)||void 0===l?void 0:l.timescale,h=d.stts,v=d.stsc,p=d.stsz,g=d.stco,m=d.stss,y=d.ctts;if(!(f&&h&&v&&p&&g&&m))return;i=(a=L(t,f,h,v,p,g,m,y)).map((function(e){return e.duration}))}if(o){var b,x,w,k=null===(b=o.mdia)||void 0===b||null===(x=b.minf)||void 0===x?void 0:x.stbl;if(!k)return;var _=null===(w=o.mdia.mdhd)||void 0===w?void 0:w.timescale,S=k.stts,O=k.stsc,E=k.stsz,j=k.stco;if(!(_&&S&&O&&E&&j))return;u=L(t,_,S,O,E,j,null,null,i)}return{videoSegments:a,audioSegments:u}}}}function L(e,t,r,n,o,i,a,u,s){var c,l,d,f,h=[],v=[],p=[],y=n.entries,b=i.entries,x=o.entrySizes,w=null==a?void 0:a.entries,k=null==u?void 0:u.entries;k&&(c=[],k.forEach((function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)c.push(r)}))),w&&(l={},w.forEach((function(e){l[e-1]=!0})));var _=0,S=0,O=0,L=0,E=0,j=y[0].samplesPerChunk,P=y[1]?y[1].firstChunk-1:1/0,I=0,T=-1;r.entries.forEach((function(e){var t=e.count,r=e.delta;f=r;for(var n=0;n<t;n++)d={dts:I,startTime:_,duration:f,size:x[S]||o.sampleSize,offset:b[O]+E,index:S},w&&(d.keyframe=l[S],d.keyframe?(T++,v.push([d]),p.push(d.duration)):(v[v.length-1].push(d),p[v.length-1]+=d.duration),d.gopId=T),c&&S<c.length&&(d.pts=I+c[S]),0===S&&(d.pts=0),h.push(d),_+=f,I+=r,++S<j?E+=d.size:(O++,E=0,O>=P&&(L++,P=y[L+1]?y[L+1].firstChunk-1:1/0),j+=y[L].samplesPerChunk)}));var D,M=h.length;if(M&&(!a||h[0].keyframe)){var A,C=[],z=[],B=0,N=0,R=function(e){var r;A=z[z.length-1],C.push({index:C.length,startTime:(null===(r=C[C.length-1])||void 0===r?void 0:r.endTime)||z[0].startTime/t,endTime:(A.startTime+A.duration)/t,duration:e,range:[z[0].offset,A.offset+A.size],frames:z}),B=0,z=[]};if(a)for(var G=e*t,K=0,F=v.length;K<F;K++){var U;B+=p[K],(U=z).push.apply(U,function(e){if(Array.isArray(e))return m(e)}(D=v[K])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(D)||g(D)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),K+1<F?(0===K||B>G)&&R(B/t):R(B/t)}else for(var Y=(s=s||[])[0]||e,H=0;H<M;H++){z.push(h[H]);var J=(B+=h[H].duration)/t;(H+1>=M||J+N>=Y)&&(N+=J-Y,R(J),Y=s[C.length]||e)}return C}}function E(e){var t="",r="",n=0,o=0,i=0,a=0,u=0,s=0,c=0;e.mvhd&&(u=e.mvhd.duration/e.mvhd.timescale);var l=e.trak;if(l){var d,f,h,v,p,g,m,y,b,x,w,k,_,S,O,L,E,j=l.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),P=l.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),I=null;return j&&(I=null===(f=j.mdia)||void 0===f||null===(h=f.minf)||void 0===h||null===(v=h.stbl)||void 0===v?void 0:v.stsd.entries[0])&&(n=I.width,o=I.height,s=null===(p=j.mdia)||void 0===p||null===(g=p.mdhd)||void 0===g?void 0:g.timescale,t=null===(m=I.avcC||I.hvcC)||void 0===m?void 0:m.codec,"encv"===I.type&&(d=null===(y=I.sinf)||void 0===y||null===(b=y.schi)||void 0===b?void 0:b.tenc.default_KID)),P&&(I=null===(x=P.mdia)||void 0===x||null===(w=x.minf)||void 0===w||null===(k=w.stbl)||void 0===k?void 0:k.stsd.entries[0])&&(i=I.channelCount,a=I.sampleRate,r=null===(_=I.esds)||void 0===_?void 0:_.codec,c=null===(S=P.mdia)||void 0===S||null===(O=S.mdhd)||void 0===O?void 0:O.timescale,"enca"===I.type&&(d=d||(null===(L=I.sinf)||void 0===L||null===(E=L.schi)||void 0===E?void 0:E.tenc.default_KID))),{kid:d?d.join(""):null,videoCodec:t,audioCodec:r,width:n,height:o,videoTimescale:s,audioChannelCount:i,audioSampleRate:a,duration:u,audioTimescale:c,moov:e}}}function j(e){return"number"==typeof e&&!Number.isNaN(e)}r(34895),r(9776),r(36195),r(94609),r(60100),r(34424),r(14643);var P=r(51962),I=["vid","cache"],T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(B,e);var t,r,n,a,c,m,L,P,T,D,M,A,C,z=(A=B,C=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(A);if(C){var r=f(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return p(this,e)});function B(e){var t;s(this,B),d(v(t=z.call(this)),"vid",""),d(v(t),"url",""),d(v(t),"meta",{}),d(v(t),"downloadInfo",[]),d(v(t),"videoSegments",[]),d(v(t),"audioSegments",[]),d(v(t),"cache",null),d(v(t),"_currentSegmentIndex",-1),d(v(t),"_currentLoadingSegmentIndex",-1),d(v(t),"buffer",void 0),d(v(t),"_error",void 0),d(v(t),"_transformError",(function(e){return e})),t._config=o({vid:"",moovEnd:8e4,segmentDuration:2,maxDownloadInfoSize:30,responseType:"arraybuffer",cache:null},e);var r=t._config,n=r.vid,i=r.cache,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,I);return t.cache=i||new S,t.vid=n||a.url,t.url=a.url,a.transformError=t._transformError,t.logger=new y.Y("MP4Loader_"+t.vid),e.openLog&&y.Y.enable(),a.logger=t.logger,t._loader=new b.mf(a),t._loader.on(x.K.REAL_TIME_SPEED,(function(e){t.emit(x.K.REAL_TIME_SPEED,e)})),t}return l(B,[{key:"isMetaLoaded",get:function(){return this.videoSegments.length||this.audioSegments.length}},{key:"setCurrentSegment",value:function(e){j(e)&&(this._currentSegmentIndex=e)}},{key:"isLastSegment",value:function(e){var t,r;return!!j(e)&&e===((null===(t=this.videoSegments[this.videoSegments.length-1])||void 0===t?void 0:t.index)||(null===(r=this.audioSegments[this.audioSegments.length-1])||void 0===r?void 0:r.index)||0)}},{key:"isSegmentLoading",value:function(e){return e===this._currentLoadingSegmentIndex}},{key:"changeUrl",value:(M=u(i().mark((function e(t){var r,n,o,a=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:t,n=a.length>2?a[2]:void 0,o=a.length>3?a[3]:void 0,e.next=5,this.reset(o);case 5:t&&(this.url=t),r&&(this.vid=r),n&&(this._config.moovEnd=n);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"getOrLoadMeta",value:(D=u(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(t);case 3:return e.abrupt("return",this.meta);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"loadMetaProcess",value:(T=u(i().mark((function e(t,r,n,a){var s,c,l,d,f=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v=2,s=function(e){if(Array.isArray(e))return e}(h=r)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(h,v)||g(h,v)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),c=s[0],l=s[1],this._error=!1,this.logger.debug("[loadMetaProcess start], range,",[c,l]),d=function(){var e=u(i().mark((function e(r,o,u){var s,d,h,v,p,g,m,y;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.meta&&null!=u&&u.range&&u.range.length>0&&u.range[1]>=l&&(o=!0,f.logger.debug("[loadMetaProcess],data done,setstate true,[",c,l,"]")),o&&null!=u&&u.range&&u.range.length>0&&u.range[1]<l&&(o=!1,f.logger.debug("[loadMetaProcess],data not done,setstate false,[",c,l,"]")),f.logger.debug("[loadMetaProcess],task,[",c,l,"], range,",u.range,",dataLen,",r?r.byteLength:void 0,", state,",o,",err,",f._error),!f._error&&r&&r.byteLength>0&&n(r,o,u),!f.meta.moov&&!f._error){e.next=6;break}return e.abrupt("return");case 6:if(!(r&&r.byteLength>0)){e.next=44;break}if(f.buffer=(0,w.gJ)(f.buffer,r),s=k.I.findBox(f.buffer,["moov"])[0]){e.next=23;break}if(d=k.I.findBox(f.buffer,["mdat"])[0],!o){e.next=23;break}if(d){e.next=18;break}return f._error=!0,n(null,o,u,{err:"cannot find moov or mdat box"}),e.abrupt("return");case 18:return h=d.start+d.size,e.next=21,f.loadData([h,""],t,a);case 21:(v=e.sent)&&(s=k.I.findBox(v.data,["moov"])[0]);case 23:if(!(s&&o&&s.size>s.data.length)){e.next=27;break}return f.logger.debug("[loadMetaProcess],moov not all, range,",u.range[1],",dataLen,",f.buffer.byteLength,", state,",o),e.next=27,f.loadMetaProcess(t,[u.range[1],s.start+s.size-1],n);case 27:if(!(s&&s.size<=s.data.length)||f.meta.moov){e.next=44;break}if(p=k.I.moov(s)){e.next=33;break}return f._error=!0,n(null,o,u,{err:"cannot parse moov box"}),e.abrupt("return");case 33:if(g=O(p,f._config.segmentDuration)){e.next=38;break}return f._error=!0,n(null,o,u,{err:"cannot parse segments"}),e.abrupt("return");case 38:f.meta=E(p),m=g.videoSegments,y=g.audioSegments,f.videoSegments=m,f.audioSegments=y,f.logger.debug("[loadMetaProcess] moov ok"),n(void 0,o,{meta:{meta:f.meta,videoSegments:m,audioSegments:y}});case 44:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),e.next=6,this.loadData([c,l||this._config.moovEnd],t,o({onProgress:d},a));case 6:case"end":return e.stop()}var h,v}),e,this)}))),function(e,t,r,n){return T.apply(this,arguments)})},{key:"loadMeta",value:(P=u(i().mark((function e(t,r,n){var o,a,u,s,c,l,d,f,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],this.logger.debug("[loadMeta start]"),e.next=4,this.loadData([0,r||this._config.moovEnd],t,n);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(o.push(a),u=k.I.findBox(a.data,["moov"])[0]){e.next=23;break}if(s=k.I.findBox(a.data,["mdat"])[0]){e.next=13;break}throw new _("cannot find moov or mdat box",a.data);case 13:return c=s.start+s.size,e.next=16,this.loadData([c],t,n);case 16:if(a=e.sent){e.next=19;break}return e.abrupt("return");case 19:if(o.push(a),u=k.I.findBox(a.data,["moov"],c)[0]){e.next=23;break}throw new _("cannot find moov box",a.data);case 23:if(!(u.size>u.data.length)){e.next=31;break}return e.next=26,this.loadData([a.data.length,u.start+u.size-1],t,n);case 26:if(a=e.sent){e.next=29;break}return e.abrupt("return");case 29:o.push(a),u.data=(0,w.gJ)(u.data,a.data);case 31:if(l=k.I.moov(u)){e.next=34;break}throw new _("cannot parse moov box",u.data);case 34:if(d=O(l,this._config.segmentDuration)){e.next=37;break}throw new _("cannot parse segments",u.data);case 37:return this.meta=E(l),f=d.videoSegments,h=d.audioSegments,this.videoSegments=f,this.audioSegments=h,this.logger.debug("[load moov end!!!!!]"),e.abrupt("return",{meta:this.meta,videoSegments:f,audioSegments:h,responses:o});case 43:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return P.apply(this,arguments)})},{key:"getSegmentByTime",value:function(e){var t,r;return this.videoSegments.length?(t=this.videoSegments.find((function(t){return t.startTime<=e&&t.endTime>e})))&&(r=this.audioSegments[t.index]):r=this.audioSegments.find((function(t){return t.startTime<=e&&t.endTime>e})),{video:t,audio:r}}},{key:"loadSegmentByTime",value:(L=u(i().mark((function e(t,r){var n,o,a,u,s,c=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(c.length>2&&void 0!==c[2])||c[2],o=c.length>3&&void 0!==c[3]?c[3]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta(r);case 5:return a=this.getSegmentByTime(t),u=a.video,s=a.audio,e.abrupt("return",this._loadSegment(u,s,r,n,o));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"loadNextSegment",value:(m=u(i().mark((function e(t){var r,n,o,a,u=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(u.length>1&&void 0!==u[1])||u[1],n=u.length>2&&void 0!==u[2]?u[2]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta();case 5:return o=this.videoSegments[this._currentSegmentIndex+1],a=this.audioSegments[this._currentSegmentIndex+1],e.abrupt("return",this._loadSegment(o,a,t,r,n));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"preload",value:(c=u(i().mark((function e(t){var r,n,o,a,s,c,l,d=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(!0);case 3:if(t&&!(t<0)){e.next=5;break}return e.abrupt("return");case 5:if(r=this.getSegmentByTime(t),n=r.video,o=r.audio,a=Math.max((null==n?void 0:n.index)||0,(null==o?void 0:o.index)||0)){e.next=9;break}return e.abrupt("return");case 9:return s=this.videoSegments.slice(0,a),c=this.audioSegments.slice(0,a),l=function(){var e=u(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>a)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,d._loadSegment(s[t],c[t],!0,!1);case 4:return e.next=6,l(t+1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=14,l(0);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"cancel",value:function(){return this._loader.cancel()}},{key:"reset",value:(a=u(i().mark((function e(){var t=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length>0&&void 0!==t[0]&&t[0]){e.next=5;break}return this.logger.debug("[MP4loader reset func call loader.cancel]"),e.next=5,this._loader.cancel();case 5:this.vid=this.url="",this.meta={},this.downloadInfo=[],this.videoSegments=[],this.audioSegments=[],this._currentSegmentIndex=-1,this._currentLoadingSegmentIndex=-1;case 12:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"destroy",value:(n=u(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reset();case 2:this.cache.clear();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_loadSegment",value:(r=u(i().mark((function e(t,r,n,o,a){var u,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||r){e.next=2;break}return e.abrupt("return");case 2:return u=(null==t?void 0:t.index)||(null==r?void 0:r.index)||0,this._currentLoadingSegmentIndex=u,e.prev=4,e.next=7,this.loadData([Math.min((null==t?void 0:t.range[0])||1/0,(null==r?void 0:r.range[0])||1/0),Math.max((null==t?void 0:t.range[1])||0,(null==r?void 0:r.range[1])||0)],n,a);case 7:s=e.sent;case 8:return e.prev=8,this._currentLoadingSegmentIndex=-1,e.finish(8);case 11:if(s){e.next=13;break}return e.abrupt("return");case 13:return o&&(this._currentSegmentIndex=u),s.video=t,s.audio=r,e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this,[[4,,8,11]])}))),function(e,t,n,o,i){return r.apply(this,arguments)})},{key:"loadData",value:(t=u(i().mark((function e(t,r,n){var a,u,s,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._getCacheKey(t),e.next=3,this.cache.get(a);case 3:if(u=e.sent){e.next=11;break}return c=n&&n.url?n.url:this.url,e.next=8,this._loader.load(c,o({range:t,vid:this.vid},n));case 8:s=e.sent,e.next=12;break;case 11:s={data:u,state:!0,options:{fromCache:!0,range:t,vid:this.vid}};case 12:if(s){e.next=14;break}return e.abrupt("return");case 14:return u||(s.data&&this.downloadInfo.push({startTime:s.startTime,endTime:s.endTime,size:s.data.byteLength,range:t}),this.downloadInfo&&this.downloadInfo.length>this._config.maxDownloadInfoSize&&(this.downloadInfo=this.downloadInfo.slice(-this._config.maxDownloadInfoSize))),e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"_getCacheKey",value:function(e){return(this.vid||this.url)+":"+e}}]),B}(r.n(P)())}}]);